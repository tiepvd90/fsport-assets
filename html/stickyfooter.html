<!-- ‚úÖ Sticky Footer -->
<div class="sticky-footer">
  <a class="footer-icon" id="call-link" href="#">
    <img src="https://img.icons8.com/ios-filled/24/000000/phone.png" alt=""><br>G·ªçi
  </a>
  <a class="footer-icon" id="chat-link" href="#">
    <img src="https://img.icons8.com/ios-filled/24/000000/facebook-messenger.png" alt=""><br>Chat
  </a>
  <button id="btn-atc" class="footer-btn">TH√äM V√ÄO GI·ªé H√ÄNG</button>
</div>

<script>
function tryOpenCartPopup(attempt = 1) {
  if (typeof toggleCartPopup === "function") {
    toggleCartPopup(true);
  } else if (attempt < 5) {
    console.warn(`üîÅ ƒê·ª£i cartpopup.js (l·∫ßn ${attempt})...`);
    setTimeout(() => tryOpenCartPopup(attempt + 1), 200);
  } else {
    console.error("‚ùå toggleCartPopup ch∆∞a s·∫µn s√†ng.");
  }
}

// ‚úÖ G√°n s·ª± ki·ªán ngay l·∫≠p t·ª©c (v√¨ file n√†y ƒë∆∞·ª£c inject sau DOM ƒë√£ s·∫µn s√†ng)
const btnAtc = document.getElementById("btn-atc");
if (btnAtc) {
  btnAtc.addEventListener("click", () => {
    const loai = window.productCategory || "unknown";
    console.log("üõí Click btn-atc:", loai);

    if (typeof trackBothPixels === "function") {
      trackBothPixels("AddToCart", {
        content_name: "click_btn_atc_" + loai,
        content_category: loai
      });
    }

    tryOpenCartPopup();
  });
}

// ‚úÖ G√°n link g·ªçi/chat n·∫øu c√≥ settings
fetch("https://friendly-kitten-d760ff.netlify.app/json/settings.json")
  .then(res => res.json())
  .then(data => {
    const callLink = document.getElementById("call-link");
    const chatLink = document.getElementById("chat-link");
    if (callLink && data.tel) {
      callLink.href = "tel:" + data.tel;
    }
    if (chatLink && data["fb-page"]) {
      chatLink.href = data["fb-page"];
    }
  })
  .catch(err => console.warn("‚ö†Ô∏è L·ªói t·∫£i settings.json:", err));
</script>
