<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Cart Popup - Funsport</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- ‚úÖ Giao di·ªán gi·ªè h√†ng -->
  <link rel="stylesheet" href="https://friendly-kitten-d760ff.netlify.app/css/cartpopup.css" />
</head>
<body>

<!-- ‚úÖ N√∫t g·ªçi gi·ªè h√†ng (n√™n ƒë∆∞·ª£c nh√∫ng t·ª´ mainblock) -->
<button id="btn-atc" class="footer-btn" onclick="toggleCartPopup(true)">TH√äM V√ÄO GI·ªé H√ÄNG</button>

<!-- ‚úÖ Container ch·ª©a ƒë∆∞·ªùng d·∫´n JSON -->
<div id="cartContainer" data-json="https://friendly-kitten-d760ff.netlify.app/json/chair.json"></div>

<!-- ‚úÖ POPUP GI·ªé H√ÄNG -->
<div id="cartPopup" class="cart-popup hidden" style="display: none;">
  <div class="cart-popup-overlay" onclick="toggleCartPopup(false)"></div>
  <div class="cart-popup-content">

    <!-- ‚ùå N√∫t ƒë√≥ng -->
    <button class="cart-popup-close" onclick="toggleCartPopup(false)">&times;</button>

    <!-- üñºÔ∏è Header s·∫£n ph·∫©m -->
    <div class="product-header" style="display: flex; gap: 12px;">
      <img id="mainImage" src="" alt="·∫¢nh s·∫£n ph·∫©m" style="width: 120px; border-radius: 8px; object-fit: cover;" />
      <div class="product-info" style="display: flex; flex-direction: column; flex: 1;">
        <div>
          <div class="product-price">
            <span class="price-sale" id="productPrice">0ƒë</span>
            <span class="price-original" id="productOriginalPrice">0ƒë</span>
          </div>
          <div id="voucherLabel" style="
            display: none;
            background-color: rgba(0, 160, 230, 0.6);
            color: white;
            font-weight: bold;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 13px;
            margin-top: 6px;
            width: fit-content;"></div>
          <div id="finalPriceLine" style="display: none; font-weight: bold; color: #d32f2f; margin-top: 4px;"></div>
        </div>

        <div style="flex: 1;"></div>

        <div class="product-variant" id="productVariantText" style="font-size: 14px; color: #333;"></div>
      </div>
    </div>

    <!-- üß© Danh s√°ch ph√¢n lo·∫°i -->
    <div class="variant-list" id="variantList"></div>

    <!-- üî¢ S·ªë l∆∞·ª£ng -->
    <div class="quantity-wrapper">
      <label for="quantityInput" style="margin-right: 8px;">S·ªë l∆∞·ª£ng:</label>
      <div class="quantity-control">
        <button type="button" onclick="changeQuantity(-1)">‚àí</button>
        <input type="number" id="quantityInput" min="1" value="1" />
        <button type="button" onclick="changeQuantity(1)">+</button>
      </div>
    </div>

    <!-- ‚úÖ N√∫t submit -->
    <button id="cartSubmitBtn" class="cart-submit-btn">TH√äM V√ÄO GI·ªé H√ÄNG</button>
  </div>
</div>

<!-- ‚úÖ Script c·∫ßn thi·∫øt -->
<script src="https://friendly-kitten-d760ff.netlify.app/js/voucherpopup.js"></script>
<script src="https://friendly-kitten-d760ff.netlify.app/js/cartpopup.js"></script>

<!-- ‚úÖ Kh·ªüi t·∫°o sau DOM -->
<script>
document.addEventListener("DOMContentLoaded", async () => {
  let map = {};
  if (typeof fetchVoucherMap === "function") {
    try {
      map = await fetchVoucherMap();
    } catch (e) {
      console.warn("Voucher fetch failed:", e);
    }
  }

  window.voucherByProduct = {};
  window.__vouchersRaw = map?.[window.loai || "chair"] || {};

  initCartPopup(); // lu√¥n g·ªçi sau khi c√≥ voucher
});
</script>

</body>
</html>
