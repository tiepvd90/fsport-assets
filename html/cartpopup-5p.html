<!-- Container để gắn data-json từ productPage/productCategory -->
<div id="cartContainer"></div>

<script>
  // Set context (tuỳ trang bạn có thể gán trước ở <head>)
  window.productPage = window.productPage || "test";
  window.productCategory = window.productCategory || "art";

  // Gắn data-json cho #cartContainer theo quy ước của bạn
  function initCartContainer() {
    const container = document.getElementById("cartContainer");
    const productPage = window.productPage || "default";
    const category = window.productCategory || "tshirt";
    if (!container) return;

    fetch(`/json/${productPage}.json`)
      .then(res => {
        if (!res.ok) throw new Error("Primary JSON not found");
        container.setAttribute("data-json", `/json/${productPage}.json`);
      })
      .catch(() => {
        container.setAttribute("data-json", `/json/${category}/${productPage}.json`);
      });
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initCartContainer);
  } else {
    initCartContainer();
  }
</script>

<!-- ✅ Popup giỏ hàng (HTML cho 5p) -->
<div id="cartPopup" class="cart-popup hidden" style="display:none;">
  <div class="cart-popup-overlay" onclick="toggleCartPopup(false)"></div>

  <div class="cart-popup-content" role="dialog" aria-modal="true" aria-labelledby="productVariantText">
    <button class="cart-popup-close" onclick="toggleCartPopup(false)" aria-label="Đóng">&times;</button>

    <!-- Header: Ảnh + Giá + Mô tả biến thể -->
    <div class="product-header" style="display:flex; gap:12px;">
      <img id="mainImage" src="" alt="Ảnh sản phẩm" decoding="async" />
      <div class="product-info" style="display:flex; flex-direction:column; flex:1;">
        <div class="product-price" aria-live="polite">
          <span class="price-original" id="productOriginalPrice">0đ</span>
          <span class="price-sale" id="productPrice">0đ</span>
        </div>
        <div id="voucherLabel"
             style="display:none; background-color:rgba(0,160,230,0.6); color:#fff; font-weight:bold; padding:4px 10px; border-radius:8px; font-size:13px; margin-top:6px; width:fit-content;">
        </div>
        <div id="finalPriceLine" style="display:none; font-weight:bold; color:#d32f2f; margin-top:4px;"></div>

        <div style="flex:1;"></div>
        <div class="product-variant" id="productVariantText" style="font-size:14px; color:#333;"></div>
      </div>
    </div>

    <!-- Khu render thuộc tính -->
    <div class="variant-list" id="variantList"></div>

    <!-- Bộ đếm multiselect & thông báo lỗi theo rule -->
    <div id="designCounter" class="multiselect-counter" aria-live="polite"></div>
    <div id="formError" class="form-error" aria-live="polite"></div>

    <!-- Số lượng bộ set đặt mua -->
    <div class="quantity-wrapper">
      <label for="quantityInput" style="margin-right:8px;">Số lượng:</label>
      <div class="quantity-control">
        <button type="button" onclick="changeQuantity(-1)" aria-label="Giảm">−</button>
        <input type="number" id="quantityInput" min="1" value="1" inputmode="numeric" />
        <button type="button" onclick="changeQuantity(1)" aria-label="Tăng">+</button>
      </div>
    </div>

    <!-- Thanh hành động trong popup (nếu bạn không dùng nút ngoài) -->
    <div class="action-bar">
      <button id="btn-atc" disabled>ĐẶT HÀNG</button>
    </div>
  </div>
</div>
