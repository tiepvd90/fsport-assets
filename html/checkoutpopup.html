<!-- ‚úÖ CHECKOUT POPUP -->
<div id="checkoutPopup" class="hidden" style="display: none;">
  <div class="checkout-overlay" onclick="hideCheckoutPopup()"></div>

  <div class="checkout-content">
    <!-- ‚ùå N√∫t ƒë√≥ng c·ªë ƒë·ªãnh -->
    <button class="checkout-close" onclick="hideCheckoutPopup()">&times;</button>

    <!-- üîÑ N·ªôi dung c√≥ th·ªÉ cu·ªôn -->
    <div class="checkout-inner-scroll">

      <!-- === M·ª§C 1: DANH S√ÅCH S·∫¢N PH·∫®M === -->
      <div class="checkout-section-title">1. Danh s√°ch s·∫£n ph·∫©m</div>
      <div id="checkoutCartList"></div>
      <div id="emptyCartText" style="display: none; color: #888; font-size: 14px; margin-bottom: 12px;">
        Gi·ªè h√†ng c·ªßa b·∫°n hi·ªán ƒëang tr·ªëng.
      </div>

      <!-- === M·ª§C 2: T·ªîNG K·∫æT ƒê∆†N H√ÄNG === -->
      <div class="checkout-section-title">2. Th√¥ng tin ƒë∆°n h√†ng</div>
      <div class="checkout-summary">
        <div class="row">
          <span>
            T·∫°m t√≠nh <span id="itemQuantityText"></span>
          </span>
          <span id="subtotalText">0‚Ç´</span>
        </div>

        <div class="row">
          <span>Ph√≠ v·∫≠n chuy·ªÉn</span>
          <span id="shippingFeeText">0‚Ç´</span>
        </div>

        <div class="row">
          <span>Voucher</span>
          <span id="voucherText" style="color: red;">-0‚Ç´</span>
        </div>

        <div class="row total-row">
          <span>T·ªïng</span>
          <span id="totalText">0‚Ç´</span>
        </div>

        <div class="note">
          <span class="red-dot-icon">üíØ</span>
          <em>ki·ªÉm tra h√†ng tr∆∞·ªõc khi thanh to√°n</em>
        </div>
      </div>

      <!-- === M·ª§C 3: TH√îNG TIN NG∆Ø·ªúI NH·∫¨N === -->
      <div class="checkout-section-title">3. Th√¥ng tin ng∆∞·ªùi nh·∫≠n</div>
      <div class="checkout-form">
        <div class="form-row">
          <input type="text" id="checkoutName" placeholder="H·ªç v√† T√™n" />
          <input type="tel" id="checkoutPhone" placeholder="S·ªë ƒëi·ªán tho·∫°i" />
        </div>
        <input type="text" id="checkoutAddress" placeholder="ƒê·ªãa ch·ªâ nh·∫≠n h√†ng" />
      </div>

      <!-- üîò N√∫t ƒë·∫∑t h√†ng -->
      <button id="checkoutSubmitBtn">ƒê·∫∂T H√ÄNG NGAY</button>
    </div>
  </div>
</div>

<!-- ‚úÖ ICON GI·ªé H√ÄNG G√ìC PH·∫¢I TR√äN -->
<div id="cartIcon" onclick="showCheckoutPopup()">
  <img src="/assets/images/carticon.png" alt="Gi·ªè h√†ng" class="cart-icon-img">
  <div id="cartItemCount">0</div>
</div>

<!-- ‚úÖ POPUP C·∫¢M ∆†N + UPSELL -->
<div id="thankyouPopup"
     style="position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 9999; display: none; align-items: center; justify-content: center; font-family: 'Be Vietnam Pro', sans-serif;">
  <div style="background: white; padding: 24px 20px; border-radius: 12px; max-width: 90%; width: 360px; text-align: center; position: relative; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">

    <!-- ‚ùå N√∫t ƒë√≥ng -->
    <button onclick="hideThankyouPopup()" 
            style="position: absolute; top: 10px; right: 12px; background: none; border: none; font-size: 26px; font-weight: bold; color: #000; cursor: pointer;">
      √ó
    </button>

    <!-- üéâ Ti√™u ƒë·ªÅ -->
    <h3 style="color: green; font-size: 20px; margin-bottom: 18px;">üéâ C·∫¢M ∆†N B·∫†N ƒê√É ƒê·∫∂T H√ÄNG!</h3>

    <!-- ‚ö° UPSELL B√ìNG -->
    <div style="border: 1px solid #eee; border-radius: 10px; padding: 16px; text-align: center;">
      <img src="https://i.postimg.cc/N0mGVKsP/1.webp" alt="B√≥ng Pickleball"
           style="width: 140px; margin: 0 auto 12px auto; display: block; border-radius: 6px;">
      <p style="font-size: 15px; margin-bottom: 16px; line-height: 1.5;">
        B·∫°n ƒëang ƒë∆∞·ª£c <b>gi·∫£m 10%</b> khi mua <b>combo 5 b√≥ng thi ƒë·∫•u d·∫° quang</b>,<br>
        ch·ªâ c√≤n <b style="color:#e63946;">130k</b>.<br>
        B·∫°n c√≥ mu·ªën mua lu√¥n kh√¥ng?
      </p>
      <div style="display: flex; justify-content: center; gap: 12px;">
        <button onclick="buyUpsellBalls()" 
                style="flex: 1; background: #e63946; color: #fff; padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
          Mua 5 b√≥ng
        </button>
        <button onclick="hideThankyouPopup()" 
                style="flex: 1; background: #ccc; color: #000; padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">
          ƒê·ªÉ sau
        </button>
      </div>
    </div>
  </div>
</div>

<script>
function showThankyouPopup() {
  document.getElementById("thankyouPopup").style.display = "flex";
  document.body.style.overflow = "hidden";
}

function hideThankyouPopup() {
  document.getElementById("thankyouPopup").style.display = "none";
  document.body.style.overflow = "";
}

// ‚úÖ G·ª≠i th√¥ng tin upsell + checkoutInfo
function buyUpsellBalls() {
  const saved = JSON.parse(localStorage.getItem("checkoutInfo") || "{}");

  fetch("https://hook.eu2.make.com/nesjrnsxqti4h10pncwkq6zkohstmlx1", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      product: "Combo 5 b√≥ng pickleball d·∫° quang",
      offer: "Gi·∫£m 10%",
      price: "130000",
      source: "thankyouPopup",
      customer: {
        name: saved.name || "",
        phone: saved.phone || "",
        address: saved.address || ""
      }
    })
  })
  .then(res => {
    console.log("Upsell ƒë√£ g·ª≠i:", res.status);
    alert("‚úÖ ƒê√£ th√™m combo 5 b√≥ng v√†o ƒë∆°n h√†ng!");
    hideThankyouPopup();
  })
  .catch(err => {
    console.error("L·ªói upsell:", err);
    hideThankyouPopup();
  });
}
</script>

