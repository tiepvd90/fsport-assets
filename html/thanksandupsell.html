<!-- ‚úÖ POPUP C·∫¢M ∆†N + (UPSELL n·∫øu pickleball) -->
<div
  id="thankyouPopup"
  class="thankyou-overlay"
  role="dialog"
  aria-modal="true"
  style="display:none;"
>
  <div class="thankyou-box">
    <!-- N√∫t ƒë√≥ng -->
    <button class="thankyou-close" onclick="hideThankyouPopup()" aria-label="ƒê√≥ng">√ó</button>

    <!-- ===== UPSSELL BLOCK (ƒë·∫∑t TR√äN C√ôNG) ===== -->
    <div id="upsellBlock" class="upsell-block">
      <div class="upsell-flex">
        <img
          class="upsell-img"
          src="https://i.postimg.cc/N0mGVKsP/1.webp"
          alt="Combo 5 b√≥ng pickleball d·∫° quang"
          loading="lazy"
        />
        <div class="upsell-info">
          <div class="upsell-title">∆Øu ƒê√£i Th√™m Cho ƒê∆°n Pickleball</div>
          <p class="upsell-desc">
            Gi·∫£m <strong>10%</strong> combo <strong>5 b√≥ng thi ƒë·∫•u d·∫° quang</strong> ‚Äì ch·ªâ c√≤n
            <span class="upsell-price">130.000‚Ç´</span>.
          </p>

          <div class="upsell-actions">
            <button id="upsellBtn" class="upsell-btn">
              TH√äM COMBO 5 B√ìNG ‚Äì 130.000‚Ç´
            </button>
            <button class="upsell-secondary" onclick="hideThankyouPopup()">
              ƒê·ªÇ SAU
            </button>
          </div>

          <div id="upsellStatus" class="upsell-status hidden">
            ‚úÖ ƒê√£ th√™m combo 5 b√≥ng v√†o ƒë∆°n!
          </div>
        </div>
      </div>
    </div>

    <!-- ===== KH·ªêI C·∫¢M ∆†N (ƒë·∫∑t B√äN D∆Ø·ªöI, lu√¥n hi·ªÉn th·ªã) ===== -->
    <div id="thankyouMessage" class="thankyou-minimal" aria-live="polite">
      <div class="thankyou-text">
        <h3 class="thankyou-title">ƒê·∫∑t H√†ng Th√†nh C√¥ng</h3>
        <p class="thankyou-note">
          C·∫£m ∆°n b·∫°n ƒë√£ ƒë·∫∑t h√†ng, ch√∫ng t√¥i ƒë√£ nh·∫≠n ƒë∆∞·ª£c th√¥ng tin v√† s·∫Ω li√™n h·ªá l·∫°i.
          N·∫øu c·∫ßn h·ªó tr·ª£ g·ª≠i h√†ng s·ªõm, vui l√≤ng li√™n h·ªá:
        </p>
      </div>

      <!-- Li√™n h·ªá nhanh: icon-only -->
      <div class="contact-icons">
        <a
          class="contact-icon"
          href="https://m.me/funsport1"
          target="_blank"
          rel="noopener"
          aria-label="Li√™n h·ªá qua Messenger"
        >
          <img src="https://i.postimg.cc/4y2DGCpz/icon-mess.webp" alt="Messenger" />
        </a>

        <a
          class="contact-icon"
          href="https://zalo.me/0384735980"
          target="_blank"
          rel="noopener"
          aria-label="Li√™n h·ªá qua Zalo"
        >
          <img src="https://i.postimg.cc/76jKxxfM/zalo-2.webp" alt="Zalo" />
        </a>
      </div>
    </div>
  </div>

  <!-- ‚öôÔ∏è Inline script g√≥i to√†n b·ªô logic ƒë·ªÉ ch·∫Øc ch·∫Øn ch·∫°y -->
  <script>
  (function () {
    console.log("[thanksandupsell] HTML injected & self-contained bridge ready");

    // ===== Config (s·ª≠a n·∫øu c·∫ßn) =====
    const HOOK_URL = "https://hook.eu2.make.com/your-upsell-hook-id"; // üîÅ thay b·∫±ng hook th·ª±c
    const COMBO_PRICE = 130000;
    const UNIT_PRICE = 26000;
    const QUANTITY = 5;

    // ===== Cache refs =====
    function $(id) { return document.getElementById(id); }
    const popup = $("thankyouPopup");
    const upsellBlock = $("upsellBlock");
    const upsellBtn = $("upsellBtn");
    const upsellStatus = $("upsellStatus");

    // üîß Critical inline styles ƒë·ªÉ overlay lu√¥n hi·ªán k·ªÉ c·∫£ khi CSS ngo√†i ch∆∞a load
    function applyCriticalOverlayStyles() {
      popup.style.position = "fixed";
      popup.style.inset = "0";
      popup.style.background = "rgba(0,0,0,.6)";
      popup.style.zIndex = "99999";
      popup.style.display = "flex";
      popup.style.alignItems = "center";
      popup.style.justifyContent = "center";
    }

    // ===== API c≈© (bridge) ‚Äì ƒë∆∞·ª£c checkoutpopup.js g·ªçi =====
    window.showThankyouPopup = function () {
      if (!popup) { console.warn("[thanksandupsell] #thankyouPopup not found"); return; }

      // Reset UI l·∫ßn m·ªü m·ªõi
      if (upsellStatus) upsellStatus.classList.add("hidden");
      if (upsellBtn) {
        upsellBtn.disabled = false;
        upsellBtn.textContent = "TH√äM COMBO 5 B√ìNG ‚Äì 130.000‚Ç´";
      }

      // Quy·∫øt ƒë·ªãnh ·∫©n/hi·ªán upsell theo category trang
      const pageCat = (window.productCategory || "").toLowerCase();
      if (pageCat === "pickleball") {
        upsellBlock && upsellBlock.classList.remove("hidden");
      } else {
        upsellBlock && upsellBlock.classList.add("hidden");
      }

      // B·∫≠t overlay (critical style)
      applyCriticalOverlayStyles();
      document.body.style.overflow = "hidden";

      // L∆∞u th√¥ng tin kh√°ch (n·∫øu c√≥) ƒë·ªÉ g·ª≠i upsell
      try {
        window._lastCustomerInfo = JSON.parse(localStorage.getItem("checkoutInfo") || "{}");
      } catch {
        window._lastCustomerInfo = {};
      }
    };

    window.hideThankyouPopup = function () {
      if (!popup) return;
      popup.style.display = "none";
      document.body.style.overflow = "auto";
    };

    // ===== N√∫t mua upsell =====
    upsellBtn && upsellBtn.addEventListener("click", function () {
      if (upsellBtn.disabled) return;

      const payload = {
        id: "bongthidau",
        name: (window._lastCustomerInfo && window._lastCustomerInfo.name) || "",
        phone: (window._lastCustomerInfo && window._lastCustomerInfo.phone) || "",
        address: (window._lastCustomerInfo && window._lastCustomerInfo.address) || "",
        quantity: QUANTITY,
        price: UNIT_PRICE,
        total: COMBO_PRICE,
        source: "thankyouPopup-upsell"
      };

      fetch(HOOK_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      })
      .then(function () {
        upsellBtn.textContent = "ƒê√É TH√äM COMBO";
        upsellBtn.disabled = true;
        upsellStatus && upsellStatus.classList.remove("hidden");
      })
      .catch(function (err) {
        console.error("‚ùå L·ªói upsell:", err);
        alert("C√≥ l·ªói khi th√™m s·∫£n ph·∫©m upsell. Vui l√≤ng th·ª≠ l·∫°i sau.");
      });
    });
  })();
  </script>
</div>
